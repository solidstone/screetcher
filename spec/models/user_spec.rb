require 'rails_helper'

RSpec.describe User, type: :model do
  let(:user) do 
  	FactoryGirl.build(:user)
  end
  context "when creating a new user" do
	  it "is valid" do
	  	expect(user).to be_valid
	  end

	  it "should not be valid with special characters in username" do
	  	user.username = "fail#me"
	  	expect(user).to_not be_valid
	  end

	  it "should not be valid with a space in username" do
	  	user.username = "fail me"
	  	expect(user).to_not be_valid
	  end

	  it "should not be valid with a nil username" do
	  	user.username = nil
	  	expect(user).to_not be_valid
	  end
	  it "should not be valid with an excessively long username" do
	  	user.username = "wow141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587006606315588174881520920962829254091715364367892590360011330530548820466521384146951941511609433057270365759591953092186117381932611793105118548074462379962749567351885752724891227938183011949129833673362440656643086021394946395224737190702179860943702770539217176293176752384674818467669405132000568127145263560827785771342757789609173637178721468440901224953430146549585371050792279689258923542019956112"
	  	expect(user).to_not be_valid
	  end
	  it "should not be valid with a short password" do
	  	user.password = "hackme"
	  	expect(user).to_not be_valid
	  end
	  it "should not be valid with an excessively long password" do
	  	# on second thought this rule probably doesn't make sense for security
	  	user.password = "wow141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587006606315588174881520920962829254091715364367892590360011330530548820466521384146951941511609433057270365759591953092186117381932611793105118548074462379962749567351885752724891227938183011949129833673362440656643086021394946395224737190702179860943702770539217176293176752384674818467669405132000568127145263560827785771342757789609173637178721468440901224953430146549585371050792279689258923542019956112"
	  	expect(user).to_not be_valid
	  end
	  it "should not store the password in cleartext" do
	  	password = "Thenewpassword3"
	  	user.password = password
	  	user.save
	  	user.password = "nothis"
	  	expect(user.reload.password).to_not eq(password)
	  end
	end
end
